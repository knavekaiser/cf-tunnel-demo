var ne=class extends Error{constructor(t){super(t),this.name="DenoStdInternalError"}};function et(e,t=""){if(!e)throw new ne(t)}function v(e,t,n=0){n=Math.max(0,Math.min(n,t.byteLength));let i=t.byteLength-n;return e.byteLength>i&&(e=e.subarray(0,i)),t.set(e,n),e.byteLength}var K=32*1024,te=2**32-2,ie=class{#e;#t=0;constructor(t){this.#e=t===void 0?new Uint8Array(0):new Uint8Array(t)}bytes(t={copy:!0}){return t.copy===!1?this.#e.subarray(this.#t):this.#e.slice(this.#t)}empty(){return this.#e.byteLength<=this.#t}get length(){return this.#e.byteLength-this.#t}get capacity(){return this.#e.buffer.byteLength}truncate(t){if(t===0){this.reset();return}if(t<0||t>this.length)throw Error("bytes.Buffer: truncation out of range");this.#i(this.#t+t)}reset(){this.#i(0),this.#t=0}#n(t){let n=this.#e.byteLength;return t<=this.capacity-n?(this.#i(n+t),n):-1}#i(t){et(t<=this.#e.buffer.byteLength),this.#e=new Uint8Array(this.#e.buffer,0,t)}readSync(t){if(this.empty())return this.reset(),t.byteLength===0?0:null;let n=v(this.#e.subarray(this.#t),t);return this.#t+=n,n}read(t){let n=this.readSync(t);return Promise.resolve(n)}writeSync(t){let n=this.#r(t.byteLength);return v(t,this.#e,n)}write(t){let n=this.writeSync(t);return Promise.resolve(n)}#r(t){let n=this.length;n===0&&this.#t!==0&&this.reset();let i=this.#n(t);if(i>=0)return i;let r=this.capacity;if(t<=Math.floor(r/2)-n)v(this.#e.subarray(this.#t),this.#e);else{if(r+t>te)throw new Error("The buffer cannot be grown beyond the maximum size.");{let o=new Uint8Array(Math.min(2*r+t,te));v(this.#e.subarray(this.#t),o),this.#e=o}}return this.#t=0,this.#i(Math.min(n+t,te)),n}grow(t){if(t<0)throw Error("Buffer.grow: negative count");let n=this.#r(t);this.#i(n)}async readFrom(t){let n=0,i=new Uint8Array(K);for(;;){let r=this.capacity-this.length<K,o=r?i:new Uint8Array(this.#e.buffer,this.length),s=await t.read(o);if(s===null)return n;r?this.writeSync(o.subarray(0,s)):this.#i(this.length+s),n+=s}}readFromSync(t){let n=0,i=new Uint8Array(K);for(;;){let r=this.capacity-this.length<K,o=r?i:new Uint8Array(this.#e.buffer,this.length),s=t.readSync(o);if(s===null)return n;r?this.writeSync(o.subarray(0,s)):this.#i(this.length+s),n+=s}}},pe=ie;function re(){let e,t="pending",n=new Promise((i,r)=>{e={async resolve(o){await o,t="fulfilled",i(o)},reject(o){t="rejected",r(o)}}});return Object.defineProperty(n,"state",{get:()=>t}),Object.assign(n,e)}var me;(s=>{let e;(I=>(I[I.Start=0]="Start",I[I.Current=1]="Current",I[I.End=2]="End"))(e=s.SeekMode||={});class t{localAddr={transport:"tcp",hostname:"localhost",port:5432};remoteAddr={transport:"tcp",hostname:"localhost",port:5432};rid=1;ws;buffer;empty_notifier;constructor(c){this.ws=c,this.buffer=new pe,this.empty_notifier=re(),this.ws.addEventListener("message",l=>{let I=new Uint8Array(l.data);this.buffer.write(I).then(()=>{this.empty_notifier.resolve()})}),this.ws.addEventListener("error",l=>{console.log("ws error")}),this.ws.addEventListener("close",()=>{this.empty_notifier.resolve(),console.log("ws close")}),this.ws.addEventListener("open",()=>{console.log("ws open")})}closeWrite(){throw new Error("Method not implemented.")}read(c){return this.buffer.length===0?new Promise(async(l,I)=>{if(this.empty_notifier=re(),await this.empty_notifier,this.buffer.length===0)I(0);else{let E=await this.buffer.read(c);l(E)}}):this.buffer.read(c)}write(c){return this.ws.send(c),Promise.resolve(c.byteLength)}close(){this.ws.close()}}s.TcpOverWebsocketConn=t;function n(_){return Promise.resolve(_)}s.startTls=n;function i(_){return new Promise((c,l)=>{let I={};if(_.cfClientId&&_.cfClientSecret&&(I={"CF-Access-Client-ID":_.cfClientId,"CF-Access-Client-Secret":_.cfClientSecret}),_.hostname===void 0)throw new Error("Tunnel hostname undefined");return fetch(_.hostname,{headers:{...I,Upgrade:"websocket"}}).then(A=>{if(A.webSocket){A.webSocket.accept();let g=new t(A.webSocket);c(g)}else throw new Error(`Failed to create WebSocket connection: ${A.status} ${A.statusText}`)}).catch(A=>{console.log(A.message),l(A)})})}s.connect=i;let r;(c=>{function _(l){}c.get=_})(r=s.env||={});let o;(Sn=>{class _ extends Error{}Sn.NotFound=_;class c extends Error{}Sn.PermissionDenied=c;class l extends Error{}Sn.ConnectionRefused=l;class I extends Error{}Sn.ConnectionReset=I;class E extends Error{}Sn.ConnectionAborted=E;class A extends Error{}Sn.NotConnected=A;class g extends Error{}Sn.AddrInUse=g;class R extends Error{}Sn.AddrNotAvailable=R;class D extends Error{}Sn.BrokenPipe=D;class Xe extends Error{}Sn.AlreadyExists=Xe;class fn extends Error{}Sn.InvalidData=fn;class Nn extends Error{}Sn.TimedOut=Nn;class dn extends Error{}Sn.Interrupted=dn;class En extends Error{}Sn.WriteZero=En;class an extends Error{}Sn.UnexpectedEof=an;class An extends Error{}Sn.BadResource=An;class Tn extends Error{}Sn.Http=Tn;class Un extends Error{}Sn.Busy=Un})(o=s.errors||={})})(me||={});globalThis.Deno=me;var p=class{constructor(){}register(){}unregister(){}};globalThis.FinalizationRegistry=p;import Ut from"./62edfb469c0dbacd90273cf9a0d7a478.wasm";var y=class extends Error{constructor(t){super(t)}},se=class extends y{constructor(t){super(t)}},_e=class extends y{constructor(t){super(t)}},ce=class extends y{constructor(t){super(t)}},V=class extends y{constructor(t){super(t)}};function Ie(){let e,t="pending",n=new Promise((i,r)=>{e={async resolve(o){await o,t="fulfilled",i(o)},reject(o){t="rejected",r(o)}}});return Object.defineProperty(n,"state",{get:()=>t}),Object.assign(n,e)}var Re=class{iteratorCount=0;yields=[];throws=[];signal=Ie();add(t){++this.iteratorCount,this.callIteratorNext(t[Symbol.asyncIterator]())}async callIteratorNext(t){try{let{value:n,done:i}=await t.next();i?--this.iteratorCount:this.yields.push({iterator:t,value:n})}catch(n){this.throws.push(n)}this.signal.resolve()}async*iterate(){for(;this.iteratorCount>0;){await this.signal;for(let t=0;t<this.yields.length;t++){let{iterator:n,value:i}=this.yields[t];yield i,this.callIteratorNext(n)}if(this.throws.length){for(let t of this.throws)throw t;this.throws.length=0}this.yields.length=0,this.signal=Ie()}}[Symbol.asyncIterator](){return this.iterate()}},Ce=()=>{},Fe=class{currentPromise;resolveCurrent=Ce;consumed;consume=Ce;constructor(){this.currentPromise=new Promise(t=>{this.resolveCurrent=t}),this.consumed=new Promise(t=>{this.consume=t})}reset(){this.currentPromise=new Promise(t=>{this.resolveCurrent=t}),this.consumed=new Promise(t=>{this.consume=t})}async next(){let t=await this.currentPromise;return this.consume(),this.reset(),t}async push(t){this.resolveCurrent(t),await this.consumed}[Symbol.asyncIterator](){return this}},tt=globalThis.Deno?.noColor??!0,nt=!tt;function it(e,t){return{open:`\x1B[${e.join(";")}m`,close:`\x1B[${t}m`,regexp:new RegExp(`\\x1b\\[${t}m`,"g")}}function rt(e,t){return nt?`${t.open}${e.replace(t.regexp,t.open)}${t.close}`:e}function oe(e){return rt(e,it([32],39))}new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g");function Ve(e){let t=new Uint8Array(e.buffer),n=`         +-------------------------------------------------+
`;n+=`         |${oe("  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f ")}|
`,n+=`+--------+-------------------------------------------------+----------------+
`;let i=Math.ceil(t.length/16);for(let r=0;r<i;r++){let o=r*16,s=o.toString(16).padStart(8,"0"),_=t.slice(o,o+16);n+=`|${oe(s)}| `,_.forEach(c=>n+=c.toString(16).padStart(2,"0")+" "),_.length<16&&(n+="   ".repeat(16-_.length)),n+="|",_.forEach(function(c){return n+=c>31&&c<127?oe(String.fromCharCode(c)):"."}),_.length<16&&(n+=" ".repeat(16-_.length)),n+=`|
`}return n+="+--------+-------------------------------------------------+----------------+",n}var L=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function ot(e){let t=typeof e=="string"?new TextEncoder().encode(e):e instanceof Uint8Array?e:new Uint8Array(e),n="",i,r=t.length;for(i=2;i<r;i+=3)n+=L[t[i-2]>>2],n+=L[(t[i-2]&3)<<4|t[i-1]>>4],n+=L[(t[i-1]&15)<<2|t[i]>>6],n+=L[t[i]&63];return i===r+1&&(n+=L[t[i-2]>>2],n+=L[(t[i-2]&3)<<4],n+="=="),i===r&&(n+=L[t[i-2]>>2],n+=L[(t[i-2]&3)<<4|t[i-1]>>4],n+=L[(t[i-1]&15)<<2],n+="="),n}function st(e){let t=atob(e),n=t.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=t.charCodeAt(r);return i}var ze=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ze.decode();var k=null;function F(){return(k===null||k.buffer!==d.memory.buffer)&&(k=new Uint8Array(d.memory.buffer)),k}function Oe(e,t){return ze.decode(F().subarray(e,e+t))}var h=new Array(32).fill(void 0);h.push(void 0,null,!0,!1);var B=h.length;function _t(e){B===h.length&&h.push(h.length+1);let t=B;return B=h[t],h[t]=e,t}function ct(e){return h[e]}function It(e){e<36||(h[e]=B,B=e)}function ut(e){let t=ct(e);return It(e),t}var x=0,$e=new TextEncoder("utf-8"),lt=function(e,t){return $e.encodeInto(e,t)};function ft(e,t,n){if(n===void 0){let _=$e.encode(e),c=t(_.length);return F().subarray(c,c+_.length).set(_),x=_.length,c}let i=e.length,r=t(i),o=F(),s=0;for(;s<i;s++){let _=e.charCodeAt(s);if(_>127)break;o[r+s]=_}if(s!==i){s!==0&&(e=e.slice(s)),r=n(r,i,i=s+e.length*3);let _=F().subarray(r+s,r+i),c=lt(e,_);s+=c.written}return x=s,r}function Nt(e){var t=ft(e,d.__wbindgen_malloc,d.__wbindgen_realloc),n=x,i=d.create_hash(t,n);return M.__wrap(i)}function je(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`);return e.ptr}function dt(e,t){let n=t(e.length*1);return F().set(e,n/1),x=e.length,n}function Et(e,t){je(e,M);var n=dt(t,d.__wbindgen_malloc),i=x;d.update_hash(e.ptr,n,i)}var W=null;function be(){return(W===null||W.buffer!==d.memory.buffer)&&(W=new Int32Array(d.memory.buffer)),W}function at(e,t){return F().subarray(e/1,e/1+t)}function At(e){try{let r=d.__wbindgen_add_to_stack_pointer(-16);je(e,M),d.digest_hash(r,e.ptr);var t=be()[r/4+0],n=be()[r/4+1],i=at(t,n).slice();return d.__wbindgen_free(t,n*1),i}finally{d.__wbindgen_add_to_stack_pointer(16)}}var Pe=new p(e=>d.__wbg_denohash_free(e)),M=class e{static __wrap(t){let n=Object.create(e.prototype);return n.ptr=t,Pe.register(n,n.ptr,n),n}__destroy_into_raw(){let t=this.ptr;return this.ptr=0,Pe.unregister(this),t}free(){let t=this.__destroy_into_raw();d.__wbg_denohash_free(t)}},Tt={__wbindgen_placeholder__:{__wbindgen_string_new:function(e,t){var n=Oe(e,t);return _t(n)},__wbindgen_throw:function(e,t){throw new Error(Oe(e,t))},__wbindgen_rethrow:function(e){throw ut(e)}}},St=new WebAssembly.Instance(Ut,Tt),d=St.exports,Be=new TextEncoder().encode("0123456789abcdef");function wt(e){let t=new Uint8Array(e.length*2);for(let n=0;n<t.length;n++){let i=e[n];t[n*2]=Be[i>>4],t[n*2+1]=Be[i&15]}return t}var ue=class{#e;#t;constructor(t){this.#e=Nt(t),this.#t=!1}update(t){let n;if(t instanceof Uint8Array)n=t;else if(typeof t=="string")n=new TextEncoder().encode(t);else if(ArrayBuffer.isView(t))n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);else if(t instanceof ArrayBuffer)n=new Uint8Array(t);else throw new Error("hash: `data` is invalid type");let i=65536;for(let r=0;r<n.byteLength;r+=i)Et(this.#e,new Uint8Array(n.buffer,n.byteOffset+r,Math.min(65536,n.byteLength-r)));return this}digest(){if(this.#t)throw new Error("hash: already digested");return this.#t=!0,At(this.#e)}toString(t="hex"){let n=new Uint8Array(this.digest());switch(t){case"hex":return new TextDecoder().decode(wt(n));case"base64":return ot(n);default:throw new Error("hash: invalid format")}}};function gt(e){return new ue(e)}function P(e,t){if(!t)return e;let n=0;return e=e.replace(/('[^'\\]*(?:\\.[^'\\]*)*')|("[^"\\]*(?:\\.[^"\\]*)*")|(\?\?)|(\?)/g,i=>{if(n>=t.length||/".*"/g.test(i)||/'.*'/g.test(i))return i;if(i==="??"){let o=t[n++];if(o instanceof Array)return`(${o.map(s=>P("??",[s])).join(",")})`;if(o==="*")return o;if(typeof o=="string"&&o.includes(".")){let s=o.split(".");return P(s.map(()=>"??").join("."),s)}else if(typeof o=="string"&&(o.includes(" as ")||o.includes(" AS "))){let _=o.replace(" as "," AS ").split(" AS ");return P(_.map(()=>"??").join(" AS "),_)}else return["`",o,"`"].join("")}let r=t[n++];if(r===null)return"NULL";switch(typeof r){case"object":if(r instanceof Date)return`"${Lt(r)}"`;if(r instanceof Array)return`(${r.map(o=>P("?",[o])).join(",")})`;case"string":return`"${ht(r)}"`;case"undefined":return"NULL";case"number":case"boolean":default:return r}}),e}function Lt(e){let t=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0"),r=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0"),s=e.getSeconds().toString().padStart(2,"0"),_=e.getMilliseconds().toString().padStart(3,"0");return`${t}-${n}-${i} ${r}:${o}:${s}.${_}`}function ht(e){return e.replaceAll("\\","\\\\").replaceAll('"','\\"')}var u;(function(e){e[e.NOTSET=0]="NOTSET",e[e.DEBUG=10]="DEBUG",e[e.INFO=20]="INFO",e[e.WARNING=30]="WARNING",e[e.ERROR=40]="ERROR",e[e.CRITICAL=50]="CRITICAL"})(u||(u={}));Object.keys(u).filter(e=>isNaN(Number(e)));var yt={[String(u.NOTSET)]:"NOTSET",[String(u.DEBUG)]:"DEBUG",[String(u.INFO)]:"INFO",[String(u.WARNING)]:"WARNING",[String(u.ERROR)]:"ERROR",[String(u.CRITICAL)]:"CRITICAL"};function le(e){switch(e){case"NOTSET":return u.NOTSET;case"DEBUG":return u.DEBUG;case"INFO":return u.INFO;case"WARNING":return u.WARNING;case"ERROR":return u.ERROR;case"CRITICAL":return u.CRITICAL;default:throw new Error(`no log level found for "${e}"`)}}function Je(e){let t=yt[e];if(t)return t;throw new Error(`no level name found for level: ${e}`)}var fe=class{msg;#e;#t;level;levelName;loggerName;constructor(t){this.msg=t.msg,this.#e=[...t.args],this.level=t.level,this.loggerName=t.loggerName,this.#t=new Date,this.levelName=Je(t.level)}get args(){return[...this.#e]}get datetime(){return new Date(this.#t.getTime())}},G=class{#e;#t;#n;constructor(t,n,i={}){this.#n=t,this.#e=le(n),this.#t=i.handlers||[]}get level(){return this.#e}set level(t){this.#e=t}get levelName(){return Je(this.#e)}set levelName(t){this.#e=le(t)}get loggerName(){return this.#n}set handlers(t){this.#t=t}get handlers(){return this.#t}_log(t,n,...i){if(this.level>t)return n instanceof Function?void 0:n;let r,o;n instanceof Function?(r=n(),o=this.asString(r)):o=this.asString(n);let s=new fe({msg:o,args:i,level:t,loggerName:this.loggerName});return this.#t.forEach(_=>{_.handle(s)}),n instanceof Function?r:n}asString(t){return typeof t=="string"?t:t===null||typeof t=="number"||typeof t=="bigint"||typeof t=="boolean"||typeof t>"u"||typeof t=="symbol"?String(t):t instanceof Error?t.stack:typeof t=="object"?JSON.stringify(t):"undefined"}debug(t,...n){return this._log(u.DEBUG,t,...n)}info(t,...n){return this._log(u.INFO,t,...n)}warning(t,...n){return this._log(u.WARNING,t,...n)}error(t,...n){return this._log(u.ERROR,t,...n)}critical(t,...n){return this._log(u.CRITICAL,t,...n)}},{Deno:xe}=globalThis,pt=typeof xe?.noColor=="boolean"?xe.noColor:!0,mt=!pt;function Q(e,t){return{open:`\x1B[${e.join(";")}m`,close:`\x1B[${t}m`,regexp:new RegExp(`\\x1b\\[${t}m`,"g")}}function X(e,t){return mt?`${t.open}${e.replace(t.regexp,t.open)}${t.close}`:e}function Rt(e){return X(e,Q([1],22))}function Me(e){return X(e,Q([31],39))}function Ct(e){return X(e,Q([33],39))}function Ft(e){return X(e,Q([34],39))}new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g");async function Ge(e){try{return await Deno.lstat(e),!0}catch(t){if(t instanceof Deno.errors.NotFound)return!1;throw t}}function Ot(e){try{return Deno.lstatSync(e),!0}catch(t){if(t instanceof Deno.errors.NotFound)return!1;throw t}}function He(e,t,n=0){n=Math.max(0,Math.min(n,t.byteLength));let i=t.byteLength-n;return e.byteLength>i&&(e=e.subarray(0,i)),t.set(e,n),e.byteLength}var Ne=class extends Error{constructor(t){super(t),this.name="DenoStdInternalError"}};function bt(e,t=""){if(!e)throw new Ne(t)}var De;(function(e){e.removed="removed",e.common="common",e.added="added"})(De||(De={}));function Pt(e,t){let n=0;for(;n<t.length;)n+=e.writeSync(t.subarray(n))}var Bt=4096,de=class{buf;usedBufferBytes=0;err=null;size(){return this.buf.byteLength}available(){return this.buf.byteLength-this.usedBufferBytes}buffered(){return this.usedBufferBytes}},z=class e extends de{writer;static create(t,n=4096){return t instanceof e?t:new e(t,n)}constructor(t,n=4096){super(),this.writer=t,n<=0&&(n=Bt),this.buf=new Uint8Array(n)}reset(t){this.err=null,this.usedBufferBytes=0,this.writer=t}flush(){if(this.err!==null)throw this.err;if(this.usedBufferBytes!==0){try{Pt(this.writer,this.buf.subarray(0,this.usedBufferBytes))}catch(t){throw this.err=t,t}this.buf=new Uint8Array(this.buf.length),this.usedBufferBytes=0}}writeSync(t){if(this.err!==null)throw this.err;if(t.length===0)return 0;let n=0,i=0;for(;t.byteLength>this.available();){if(this.buffered()===0)try{i=this.writer.writeSync(t)}catch(r){throw this.err=r,r}else i=He(t,this.buf,this.usedBufferBytes),this.usedBufferBytes+=i,this.flush();n+=i,t=t.subarray(i)}return i=He(t,this.buf,this.usedBufferBytes),this.usedBufferBytes+=i,n+=i,n}},xt="{levelName} {msg}",H=class{level;levelName;formatter;constructor(t,n={}){this.level=le(t),this.levelName=t,this.formatter=n.formatter||xt}handle(t){if(this.level>t.level)return;let n=this.format(t);return this.log(n)}format(t){return this.formatter instanceof Function?this.formatter(t):this.formatter.replace(/{(\S+)}/g,(n,i)=>{let r=t[i];return r==null?n:String(r)})}log(t){}async setup(){}async destroy(){}},$=class extends H{format(t){let n=super.format(t);switch(t.level){case u.INFO:n=Ft(n);break;case u.WARNING:n=Ct(n);break;case u.ERROR:n=Me(n);break;case u.CRITICAL:n=Rt(Me(n));break;default:break}return n}log(t){console.log(t)}},j=class extends H{_writer;#e=new TextEncoder},J=class extends j{_file;_buf;_filename;_mode;_openOptions;_encoder=new TextEncoder;#e(){this.destroy()}constructor(t,n){super(t,n),this._filename=n.filename,this._mode=n.mode?n.mode:"a",this._openOptions={createNew:this._mode==="x",create:this._mode!=="x",append:this._mode==="a",truncate:this._mode!=="a",write:!0}}async setup(){this._file=await Deno.open(this._filename,this._openOptions),this._writer=this._file,this._buf=new z(this._file),addEventListener("unload",this.#e.bind(this))}handle(t){super.handle(t),t.level>u.ERROR&&this.flush()}log(t){this._buf.writeSync(this._encoder.encode(t+`
`))}flush(){this._buf?.buffered()>0&&this._buf.flush()}destroy(){return this.flush(),this._file?.close(),this._file=void 0,removeEventListener("unload",this.#e),Promise.resolve()}},Ee=class extends J{#e;#t;#n=0;constructor(t,n){super(t,n),this.#e=n.maxBytes,this.#t=n.maxBackupCount}async setup(){if(this.#e<1)throw this.destroy(),new Error("maxBytes cannot be less than 1");if(this.#t<1)throw this.destroy(),new Error("maxBackupCount cannot be less than 1");if(await super.setup(),this._mode==="w")for(let t=1;t<=this.#t;t++)await Ge(this._filename+"."+t)&&await Deno.remove(this._filename+"."+t);else if(this._mode==="x"){for(let t=1;t<=this.#t;t++)if(await Ge(this._filename+"."+t))throw this.destroy(),new Deno.errors.AlreadyExists("Backup log file "+this._filename+"."+t+" already exists")}else this.#n=(await Deno.stat(this._filename)).size}log(t){let n=this._encoder.encode(t).byteLength+1;this.#n+n>this.#e&&(this.rotateLogFiles(),this.#n=0),this._buf.writeSync(this._encoder.encode(t+`
`)),this.#n+=n}rotateLogFiles(){this._buf.flush(),Deno.close(this._file.rid);for(let t=this.#t-1;t>=0;t--){let n=this._filename+(t===0?"":"."+t),i=this._filename+"."+(t+1);Ot(n)&&Deno.renameSync(n,i)}this._file=Deno.openSync(this._filename,this._openOptions),this._writer=this._file,this._buf=new z(this._file)}},ae=class{level;handlers},Ae="INFO",q={handlers:{default:new $(Ae)},loggers:{default:{level:Ae,handlers:["default"]}}},T={handlers:new Map,loggers:new Map,config:q},Mt={BaseHandler:H,ConsoleHandler:$,WriterHandler:j,FileHandler:J,RotatingFileHandler:Ee};function S(e){if(!e){let n=T.loggers.get("default");return bt(n!=null,'"default" logger must be set for getting logger without name'),n}let t=T.loggers.get(e);if(!t){let n=new G(e,"NOTSET",{handlers:[]});return T.loggers.set(e,n),n}return t}function Gt(e,...t){return e instanceof Function?S("default").debug(e,...t):S("default").debug(e,...t)}function Ht(e,...t){return e instanceof Function?S("default").info(e,...t):S("default").info(e,...t)}function Dt(e,...t){return e instanceof Function?S("default").warning(e,...t):S("default").warning(e,...t)}function vt(e,...t){return e instanceof Function?S("default").error(e,...t):S("default").error(e,...t)}function Kt(e,...t){return e instanceof Function?S("default").critical(e,...t):S("default").critical(e,...t)}async function qe(e){T.config={handlers:{...q.handlers,...e.handlers},loggers:{...q.loggers,...e.loggers}},T.handlers.forEach(i=>{i.destroy()}),T.handlers.clear();let t=T.config.handlers||{};for(let i in t){let r=t[i];await r.setup(),T.handlers.set(i,r)}T.loggers.clear();let n=T.config.loggers||{};for(let i in n){let r=n[i],o=r.handlers||[],s=[];o.forEach(l=>{let I=T.handlers.get(l);I&&s.push(I)});let _=r.level||Ae,c=new G(i,_,{handlers:s});T.loggers.set(i,c)}}await qe(q);var kt=await async function(){return{LogLevels:u,Logger:G,LoggerConfig:ae,handlers:Mt,getLogger:S,debug:Gt,info:Ht,warning:Dt,error:vt,critical:Kt,setup:qe}}(),w=kt.getLogger(),Wt=!1;function Vt(e){Wt&&e()}function ye(e,t){return e.map((n,i)=>n^t[i])}var zt=new TextEncoder,$t=new TextDecoder;function ee(e){return zt.encode(e)}function ve(e){return $t.decode(e)}var Y=class{buffer;pos;constructor(t){this.buffer=t,this.pos=0}get finished(){return this.pos>=this.buffer.length}skip(t){return this.pos+=t,this}readBuffer(t){let n=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,n}readUints(t){let n=0;for(let i=0;i<t;i++)n+=this.buffer[this.pos++]<<8*i;return n}readUint8(){return this.buffer[this.pos++]}readUint16(){return this.readUints(2)}readUint32(){return this.readUints(4)}readUint64(){return this.readUints(8)}readNullTerminatedString(){let t=this.buffer.indexOf(0,this.pos);t===-1&&(t=this.buffer.length);let n=this.buffer.slice(this.pos,t);return this.pos+=n.length+1,ve(n)}readRestOfPacketString(){return this.buffer.slice(this.pos)}readString(t){let n=ve(this.buffer.slice(this.pos,this.pos+t));return this.pos+=t,n}readEncodedLen(){let t=this.readUint8();return t<251?t:t==252?this.readUint16():t==253?this.readUints(3):t==254?this.readUints(8):-1}readLenCodeString(){let t=this.readEncodedLen();return t==-1?null:this.readString(t)}},b=class{buffer;pos;constructor(t){this.buffer=t,this.pos=0}get wroteData(){return this.buffer.slice(0,this.pos)}get length(){return this.pos}get capacity(){return this.buffer.length-this.pos}skip(t){return this.pos+=t,this}writeBuffer(t){return t.length>this.capacity&&(t=t.slice(0,this.capacity)),this.buffer.set(t,this.pos),this.pos+=t.length,this}write(t){return this.buffer[this.pos++]=t,this}writeInt16LE(t){}writeIntLE(t,n){let i=new Int32Array(1);i[0]=40,console.log(i)}writeUint16(t){return this.writeUints(2,t)}writeUint32(t){return this.writeUints(4,t)}writeUint64(t){return this.writeUints(8,t)}writeUints(t,n){for(let i=0;i<t;i++)this.buffer[this.pos++]=n>>i*8&255;return this}writeNullTerminatedString(t){return this.writeString(t).write(0)}writeString(t){let n=ee(t);return this.buffer.set(n,this.pos),this.pos+=n.length,this}};function O(e,t){return new Uint8Array(gt(e).update(t).digest())}function jt(e,t){let n=O("sha1",ee(e)),i=O("sha1",n),r=new Uint8Array(t.length+i.length);return r.set(t),r.set(i,t.length),r=O("sha1",r),ye(r,n)}function Jt(e,t){let n=O("sha256",ee(e)),i=O("sha256",n),r=O("sha256",Uint8Array.from([...i,...t]));return ye(n,r)}function Ye(e,t,n){switch(e){case"mysql_native_password":return jt(t,n.slice(0,20));case"caching_sha2_password":return Jt(t,n);default:throw new Error("Not supported")}}var f;(function(e){e[e.CLIENT_PROTOCOL_41=512]="CLIENT_PROTOCOL_41",e[e.CLIENT_CONNECT_WITH_DB=8]="CLIENT_CONNECT_WITH_DB",e[e.CLIENT_LONG_FLAG=4]="CLIENT_LONG_FLAG",e[e.CLIENT_DEPRECATE_EOF=16777216]="CLIENT_DEPRECATE_EOF",e[e.CLIENT_LONG_PASSWORD=1]="CLIENT_LONG_PASSWORD",e[e.CLIENT_TRANSACTIONS=8192]="CLIENT_TRANSACTIONS",e[e.CLIENT_MULTI_RESULTS=131072]="CLIENT_MULTI_RESULTS",e[e.CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA=2097152]="CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA",e[e.CLIENT_PLUGIN_AUTH=524288]="CLIENT_PLUGIN_AUTH",e[e.CLIENT_SECURE_CONNECTION=32768]="CLIENT_SECURE_CONNECTION",e[e.CLIENT_FOUND_ROWS=2]="CLIENT_FOUND_ROWS",e[e.CLIENT_CONNECT_ATTRS=1048576]="CLIENT_CONNECT_ATTRS",e[e.CLIENT_IGNORE_SPACE=256]="CLIENT_IGNORE_SPACE",e[e.CLIENT_IGNORE_SIGPIPE=4096]="CLIENT_IGNORE_SIGPIPE",e[e.CLIENT_RESERVED=16384]="CLIENT_RESERVED",e[e.CLIENT_PS_MULTI_RESULTS=262144]="CLIENT_PS_MULTI_RESULTS"})(f||(f={}));var Te;(function(e){e[e.BIG5_CHINESE_CI=1]="BIG5_CHINESE_CI",e[e.LATIN2_CZECH_CS=2]="LATIN2_CZECH_CS",e[e.DEC8_SWEDISH_CI=3]="DEC8_SWEDISH_CI",e[e.CP850_GENERAL_CI=4]="CP850_GENERAL_CI",e[e.LATIN1_GERMAN1_CI=5]="LATIN1_GERMAN1_CI",e[e.HP8_ENGLISH_CI=6]="HP8_ENGLISH_CI",e[e.KOI8R_GENERAL_CI=7]="KOI8R_GENERAL_CI",e[e.LATIN1_SWEDISH_CI=8]="LATIN1_SWEDISH_CI",e[e.LATIN2_GENERAL_CI=9]="LATIN2_GENERAL_CI",e[e.SWE7_SWEDISH_CI=10]="SWE7_SWEDISH_CI",e[e.ASCII_GENERAL_CI=11]="ASCII_GENERAL_CI",e[e.UJIS_JAPANESE_CI=12]="UJIS_JAPANESE_CI",e[e.SJIS_JAPANESE_CI=13]="SJIS_JAPANESE_CI",e[e.CP1251_BULGARIAN_CI=14]="CP1251_BULGARIAN_CI",e[e.LATIN1_DANISH_CI=15]="LATIN1_DANISH_CI",e[e.HEBREW_GENERAL_CI=16]="HEBREW_GENERAL_CI",e[e.TIS620_THAI_CI=18]="TIS620_THAI_CI",e[e.EUCKR_KOREAN_CI=19]="EUCKR_KOREAN_CI",e[e.LATIN7_ESTONIAN_CS=20]="LATIN7_ESTONIAN_CS",e[e.LATIN2_HUNGARIAN_CI=21]="LATIN2_HUNGARIAN_CI",e[e.KOI8U_GENERAL_CI=22]="KOI8U_GENERAL_CI",e[e.CP1251_UKRAINIAN_CI=23]="CP1251_UKRAINIAN_CI",e[e.GB2312_CHINESE_CI=24]="GB2312_CHINESE_CI",e[e.GREEK_GENERAL_CI=25]="GREEK_GENERAL_CI",e[e.CP1250_GENERAL_CI=26]="CP1250_GENERAL_CI",e[e.LATIN2_CROATIAN_CI=27]="LATIN2_CROATIAN_CI",e[e.GBK_CHINESE_CI=28]="GBK_CHINESE_CI",e[e.CP1257_LITHUANIAN_CI=29]="CP1257_LITHUANIAN_CI",e[e.LATIN5_TURKISH_CI=30]="LATIN5_TURKISH_CI",e[e.LATIN1_GERMAN2_CI=31]="LATIN1_GERMAN2_CI",e[e.ARMSCII8_GENERAL_CI=32]="ARMSCII8_GENERAL_CI",e[e.UTF8_GENERAL_CI=33]="UTF8_GENERAL_CI",e[e.CP1250_CZECH_CS=34]="CP1250_CZECH_CS",e[e.UCS2_GENERAL_CI=35]="UCS2_GENERAL_CI",e[e.CP866_GENERAL_CI=36]="CP866_GENERAL_CI",e[e.KEYBCS2_GENERAL_CI=37]="KEYBCS2_GENERAL_CI",e[e.MACCE_GENERAL_CI=38]="MACCE_GENERAL_CI",e[e.MACROMAN_GENERAL_CI=39]="MACROMAN_GENERAL_CI",e[e.CP852_GENERAL_CI=40]="CP852_GENERAL_CI",e[e.LATIN7_GENERAL_CI=41]="LATIN7_GENERAL_CI",e[e.LATIN7_GENERAL_CS=42]="LATIN7_GENERAL_CS",e[e.MACCE_BIN=43]="MACCE_BIN",e[e.CP1250_CROATIAN_CI=44]="CP1250_CROATIAN_CI",e[e.UTF8MB4_GENERAL_CI=45]="UTF8MB4_GENERAL_CI",e[e.UTF8MB4_BIN=46]="UTF8MB4_BIN",e[e.LATIN1_BIN=47]="LATIN1_BIN",e[e.LATIN1_GENERAL_CI=48]="LATIN1_GENERAL_CI",e[e.LATIN1_GENERAL_CS=49]="LATIN1_GENERAL_CS",e[e.CP1251_BIN=50]="CP1251_BIN",e[e.CP1251_GENERAL_CI=51]="CP1251_GENERAL_CI",e[e.CP1251_GENERAL_CS=52]="CP1251_GENERAL_CS",e[e.MACROMAN_BIN=53]="MACROMAN_BIN",e[e.UTF16_GENERAL_CI=54]="UTF16_GENERAL_CI",e[e.UTF16_BIN=55]="UTF16_BIN",e[e.UTF16LE_GENERAL_CI=56]="UTF16LE_GENERAL_CI",e[e.CP1256_GENERAL_CI=57]="CP1256_GENERAL_CI",e[e.CP1257_BIN=58]="CP1257_BIN",e[e.CP1257_GENERAL_CI=59]="CP1257_GENERAL_CI",e[e.UTF32_GENERAL_CI=60]="UTF32_GENERAL_CI",e[e.UTF32_BIN=61]="UTF32_BIN",e[e.UTF16LE_BIN=62]="UTF16LE_BIN",e[e.BINARY=63]="BINARY",e[e.ARMSCII8_BIN=64]="ARMSCII8_BIN",e[e.ASCII_BIN=65]="ASCII_BIN",e[e.CP1250_BIN=66]="CP1250_BIN",e[e.CP1256_BIN=67]="CP1256_BIN",e[e.CP866_BIN=68]="CP866_BIN",e[e.DEC8_BIN=69]="DEC8_BIN",e[e.GREEK_BIN=70]="GREEK_BIN",e[e.HEBREW_BIN=71]="HEBREW_BIN",e[e.HP8_BIN=72]="HP8_BIN",e[e.KEYBCS2_BIN=73]="KEYBCS2_BIN",e[e.KOI8R_BIN=74]="KOI8R_BIN",e[e.KOI8U_BIN=75]="KOI8U_BIN",e[e.LATIN2_BIN=77]="LATIN2_BIN",e[e.LATIN5_BIN=78]="LATIN5_BIN",e[e.LATIN7_BIN=79]="LATIN7_BIN",e[e.CP850_BIN=80]="CP850_BIN",e[e.CP852_BIN=81]="CP852_BIN",e[e.SWE7_BIN=82]="SWE7_BIN",e[e.UTF8_BIN=83]="UTF8_BIN",e[e.BIG5_BIN=84]="BIG5_BIN",e[e.EUCKR_BIN=85]="EUCKR_BIN",e[e.GB2312_BIN=86]="GB2312_BIN",e[e.GBK_BIN=87]="GBK_BIN",e[e.SJIS_BIN=88]="SJIS_BIN",e[e.TIS620_BIN=89]="TIS620_BIN",e[e.UCS2_BIN=90]="UCS2_BIN",e[e.UJIS_BIN=91]="UJIS_BIN",e[e.GEOSTD8_GENERAL_CI=92]="GEOSTD8_GENERAL_CI",e[e.GEOSTD8_BIN=93]="GEOSTD8_BIN",e[e.LATIN1_SPANISH_CI=94]="LATIN1_SPANISH_CI",e[e.CP932_JAPANESE_CI=95]="CP932_JAPANESE_CI",e[e.CP932_BIN=96]="CP932_BIN",e[e.EUCJPMS_JAPANESE_CI=97]="EUCJPMS_JAPANESE_CI",e[e.EUCJPMS_BIN=98]="EUCJPMS_BIN",e[e.CP1250_POLISH_CI=99]="CP1250_POLISH_CI",e[e.UTF16_UNICODE_CI=101]="UTF16_UNICODE_CI",e[e.UTF16_ICELANDIC_CI=102]="UTF16_ICELANDIC_CI",e[e.UTF16_LATVIAN_CI=103]="UTF16_LATVIAN_CI",e[e.UTF16_ROMANIAN_CI=104]="UTF16_ROMANIAN_CI",e[e.UTF16_SLOVENIAN_CI=105]="UTF16_SLOVENIAN_CI",e[e.UTF16_POLISH_CI=106]="UTF16_POLISH_CI",e[e.UTF16_ESTONIAN_CI=107]="UTF16_ESTONIAN_CI",e[e.UTF16_SPANISH_CI=108]="UTF16_SPANISH_CI",e[e.UTF16_SWEDISH_CI=109]="UTF16_SWEDISH_CI",e[e.UTF16_TURKISH_CI=110]="UTF16_TURKISH_CI",e[e.UTF16_CZECH_CI=111]="UTF16_CZECH_CI",e[e.UTF16_DANISH_CI=112]="UTF16_DANISH_CI",e[e.UTF16_LITHUANIAN_CI=113]="UTF16_LITHUANIAN_CI",e[e.UTF16_SLOVAK_CI=114]="UTF16_SLOVAK_CI",e[e.UTF16_SPANISH2_CI=115]="UTF16_SPANISH2_CI",e[e.UTF16_ROMAN_CI=116]="UTF16_ROMAN_CI",e[e.UTF16_PERSIAN_CI=117]="UTF16_PERSIAN_CI",e[e.UTF16_ESPERANTO_CI=118]="UTF16_ESPERANTO_CI",e[e.UTF16_HUNGARIAN_CI=119]="UTF16_HUNGARIAN_CI",e[e.UTF16_SINHALA_CI=120]="UTF16_SINHALA_CI",e[e.UTF16_GERMAN2_CI=121]="UTF16_GERMAN2_CI",e[e.UTF16_CROATIAN_MYSQL561_CI=122]="UTF16_CROATIAN_MYSQL561_CI",e[e.UTF16_UNICODE_520_CI=123]="UTF16_UNICODE_520_CI",e[e.UTF16_VIETNAMESE_CI=124]="UTF16_VIETNAMESE_CI",e[e.UCS2_UNICODE_CI=128]="UCS2_UNICODE_CI",e[e.UCS2_ICELANDIC_CI=129]="UCS2_ICELANDIC_CI",e[e.UCS2_LATVIAN_CI=130]="UCS2_LATVIAN_CI",e[e.UCS2_ROMANIAN_CI=131]="UCS2_ROMANIAN_CI",e[e.UCS2_SLOVENIAN_CI=132]="UCS2_SLOVENIAN_CI",e[e.UCS2_POLISH_CI=133]="UCS2_POLISH_CI",e[e.UCS2_ESTONIAN_CI=134]="UCS2_ESTONIAN_CI",e[e.UCS2_SPANISH_CI=135]="UCS2_SPANISH_CI",e[e.UCS2_SWEDISH_CI=136]="UCS2_SWEDISH_CI",e[e.UCS2_TURKISH_CI=137]="UCS2_TURKISH_CI",e[e.UCS2_CZECH_CI=138]="UCS2_CZECH_CI",e[e.UCS2_DANISH_CI=139]="UCS2_DANISH_CI",e[e.UCS2_LITHUANIAN_CI=140]="UCS2_LITHUANIAN_CI",e[e.UCS2_SLOVAK_CI=141]="UCS2_SLOVAK_CI",e[e.UCS2_SPANISH2_CI=142]="UCS2_SPANISH2_CI",e[e.UCS2_ROMAN_CI=143]="UCS2_ROMAN_CI",e[e.UCS2_PERSIAN_CI=144]="UCS2_PERSIAN_CI",e[e.UCS2_ESPERANTO_CI=145]="UCS2_ESPERANTO_CI",e[e.UCS2_HUNGARIAN_CI=146]="UCS2_HUNGARIAN_CI",e[e.UCS2_SINHALA_CI=147]="UCS2_SINHALA_CI",e[e.UCS2_GERMAN2_CI=148]="UCS2_GERMAN2_CI",e[e.UCS2_CROATIAN_MYSQL561_CI=149]="UCS2_CROATIAN_MYSQL561_CI",e[e.UCS2_UNICODE_520_CI=150]="UCS2_UNICODE_520_CI",e[e.UCS2_VIETNAMESE_CI=151]="UCS2_VIETNAMESE_CI",e[e.UCS2_GENERAL_MYSQL500_CI=159]="UCS2_GENERAL_MYSQL500_CI",e[e.UTF32_UNICODE_CI=160]="UTF32_UNICODE_CI",e[e.UTF32_ICELANDIC_CI=161]="UTF32_ICELANDIC_CI",e[e.UTF32_LATVIAN_CI=162]="UTF32_LATVIAN_CI",e[e.UTF32_ROMANIAN_CI=163]="UTF32_ROMANIAN_CI",e[e.UTF32_SLOVENIAN_CI=164]="UTF32_SLOVENIAN_CI",e[e.UTF32_POLISH_CI=165]="UTF32_POLISH_CI",e[e.UTF32_ESTONIAN_CI=166]="UTF32_ESTONIAN_CI",e[e.UTF32_SPANISH_CI=167]="UTF32_SPANISH_CI",e[e.UTF32_SWEDISH_CI=168]="UTF32_SWEDISH_CI",e[e.UTF32_TURKISH_CI=169]="UTF32_TURKISH_CI",e[e.UTF32_CZECH_CI=170]="UTF32_CZECH_CI",e[e.UTF32_DANISH_CI=171]="UTF32_DANISH_CI",e[e.UTF32_LITHUANIAN_CI=172]="UTF32_LITHUANIAN_CI",e[e.UTF32_SLOVAK_CI=173]="UTF32_SLOVAK_CI",e[e.UTF32_SPANISH2_CI=174]="UTF32_SPANISH2_CI",e[e.UTF32_ROMAN_CI=175]="UTF32_ROMAN_CI",e[e.UTF32_PERSIAN_CI=176]="UTF32_PERSIAN_CI",e[e.UTF32_ESPERANTO_CI=177]="UTF32_ESPERANTO_CI",e[e.UTF32_HUNGARIAN_CI=178]="UTF32_HUNGARIAN_CI",e[e.UTF32_SINHALA_CI=179]="UTF32_SINHALA_CI",e[e.UTF32_GERMAN2_CI=180]="UTF32_GERMAN2_CI",e[e.UTF32_CROATIAN_MYSQL561_CI=181]="UTF32_CROATIAN_MYSQL561_CI",e[e.UTF32_UNICODE_520_CI=182]="UTF32_UNICODE_520_CI",e[e.UTF32_VIETNAMESE_CI=183]="UTF32_VIETNAMESE_CI",e[e.UTF8_UNICODE_CI=192]="UTF8_UNICODE_CI",e[e.UTF8_ICELANDIC_CI=193]="UTF8_ICELANDIC_CI",e[e.UTF8_LATVIAN_CI=194]="UTF8_LATVIAN_CI",e[e.UTF8_ROMANIAN_CI=195]="UTF8_ROMANIAN_CI",e[e.UTF8_SLOVENIAN_CI=196]="UTF8_SLOVENIAN_CI",e[e.UTF8_POLISH_CI=197]="UTF8_POLISH_CI",e[e.UTF8_ESTONIAN_CI=198]="UTF8_ESTONIAN_CI",e[e.UTF8_SPANISH_CI=199]="UTF8_SPANISH_CI",e[e.UTF8_SWEDISH_CI=200]="UTF8_SWEDISH_CI",e[e.UTF8_TURKISH_CI=201]="UTF8_TURKISH_CI",e[e.UTF8_CZECH_CI=202]="UTF8_CZECH_CI",e[e.UTF8_DANISH_CI=203]="UTF8_DANISH_CI",e[e.UTF8_LITHUANIAN_CI=204]="UTF8_LITHUANIAN_CI",e[e.UTF8_SLOVAK_CI=205]="UTF8_SLOVAK_CI",e[e.UTF8_SPANISH2_CI=206]="UTF8_SPANISH2_CI",e[e.UTF8_ROMAN_CI=207]="UTF8_ROMAN_CI",e[e.UTF8_PERSIAN_CI=208]="UTF8_PERSIAN_CI",e[e.UTF8_ESPERANTO_CI=209]="UTF8_ESPERANTO_CI",e[e.UTF8_HUNGARIAN_CI=210]="UTF8_HUNGARIAN_CI",e[e.UTF8_SINHALA_CI=211]="UTF8_SINHALA_CI",e[e.UTF8_GERMAN2_CI=212]="UTF8_GERMAN2_CI",e[e.UTF8_CROATIAN_MYSQL561_CI=213]="UTF8_CROATIAN_MYSQL561_CI",e[e.UTF8_UNICODE_520_CI=214]="UTF8_UNICODE_520_CI",e[e.UTF8_VIETNAMESE_CI=215]="UTF8_VIETNAMESE_CI",e[e.UTF8_GENERAL_MYSQL500_CI=223]="UTF8_GENERAL_MYSQL500_CI",e[e.UTF8MB4_UNICODE_CI=224]="UTF8MB4_UNICODE_CI",e[e.UTF8MB4_ICELANDIC_CI=225]="UTF8MB4_ICELANDIC_CI",e[e.UTF8MB4_LATVIAN_CI=226]="UTF8MB4_LATVIAN_CI",e[e.UTF8MB4_ROMANIAN_CI=227]="UTF8MB4_ROMANIAN_CI",e[e.UTF8MB4_SLOVENIAN_CI=228]="UTF8MB4_SLOVENIAN_CI",e[e.UTF8MB4_POLISH_CI=229]="UTF8MB4_POLISH_CI",e[e.UTF8MB4_ESTONIAN_CI=230]="UTF8MB4_ESTONIAN_CI",e[e.UTF8MB4_SPANISH_CI=231]="UTF8MB4_SPANISH_CI",e[e.UTF8MB4_SWEDISH_CI=232]="UTF8MB4_SWEDISH_CI",e[e.UTF8MB4_TURKISH_CI=233]="UTF8MB4_TURKISH_CI",e[e.UTF8MB4_CZECH_CI=234]="UTF8MB4_CZECH_CI",e[e.UTF8MB4_DANISH_CI=235]="UTF8MB4_DANISH_CI",e[e.UTF8MB4_LITHUANIAN_CI=236]="UTF8MB4_LITHUANIAN_CI",e[e.UTF8MB4_SLOVAK_CI=237]="UTF8MB4_SLOVAK_CI",e[e.UTF8MB4_SPANISH2_CI=238]="UTF8MB4_SPANISH2_CI",e[e.UTF8MB4_ROMAN_CI=239]="UTF8MB4_ROMAN_CI",e[e.UTF8MB4_PERSIAN_CI=240]="UTF8MB4_PERSIAN_CI",e[e.UTF8MB4_ESPERANTO_CI=241]="UTF8MB4_ESPERANTO_CI",e[e.UTF8MB4_HUNGARIAN_CI=242]="UTF8MB4_HUNGARIAN_CI",e[e.UTF8MB4_SINHALA_CI=243]="UTF8MB4_SINHALA_CI",e[e.UTF8MB4_GERMAN2_CI=244]="UTF8MB4_GERMAN2_CI",e[e.UTF8MB4_CROATIAN_MYSQL561_CI=245]="UTF8MB4_CROATIAN_MYSQL561_CI",e[e.UTF8MB4_UNICODE_520_CI=246]="UTF8MB4_UNICODE_520_CI",e[e.UTF8MB4_VIETNAMESE_CI=247]="UTF8MB4_VIETNAMESE_CI",e[e.UTF8_GENERAL50_CI=253]="UTF8_GENERAL50_CI",e[e.ARMSCII8=32]="ARMSCII8",e[e.ASCII=11]="ASCII",e[e.BIG5=1]="BIG5",e[e.CP1250=26]="CP1250",e[e.CP1251=51]="CP1251",e[e.CP1256=57]="CP1256",e[e.CP1257=59]="CP1257",e[e.CP866=36]="CP866",e[e.CP850=4]="CP850",e[e.CP852=40]="CP852",e[e.CP932=95]="CP932",e[e.DEC8=3]="DEC8",e[e.EUCJPMS=97]="EUCJPMS",e[e.EUCKR=19]="EUCKR",e[e.GB2312=24]="GB2312",e[e.GBK=28]="GBK",e[e.GEOSTD8=92]="GEOSTD8",e[e.GREEK=25]="GREEK",e[e.HEBREW=16]="HEBREW",e[e.HP8=6]="HP8",e[e.KEYBCS2=37]="KEYBCS2",e[e.KOI8R=7]="KOI8R",e[e.KOI8U=22]="KOI8U",e[e.LATIN1=8]="LATIN1",e[e.LATIN2=9]="LATIN2",e[e.LATIN5=30]="LATIN5",e[e.LATIN7=41]="LATIN7",e[e.MACCE=38]="MACCE",e[e.MACROMAN=39]="MACROMAN",e[e.SJIS=13]="SJIS",e[e.SWE7=10]="SWE7",e[e.TIS620=18]="TIS620",e[e.UCS2=35]="UCS2",e[e.UJIS=12]="UJIS",e[e.UTF16=54]="UTF16",e[e.UTF16LE=56]="UTF16LE",e[e.UTF8=33]="UTF8",e[e.UTF8MB4=45]="UTF8MB4",e[e.UTF32=60]="UTF32"})(Te||(Te={}));function qt(e,t){let n=(t.db?f.CLIENT_CONNECT_WITH_DB:0)|f.CLIENT_PLUGIN_AUTH|f.CLIENT_LONG_PASSWORD|f.CLIENT_PROTOCOL_41|f.CLIENT_TRANSACTIONS|f.CLIENT_MULTI_RESULTS|f.CLIENT_SECURE_CONNECTION|f.CLIENT_LONG_FLAG&e.serverCapabilities|f.CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA&e.serverCapabilities|f.CLIENT_DEPRECATE_EOF&e.serverCapabilities;if(e.serverCapabilities&f.CLIENT_PLUGIN_AUTH){let i=new b(new Uint8Array(1e3));if(i.writeUint32(n).writeUint32(2**24-1).write(Te.UTF8_GENERAL_CI).skip(23).writeNullTerminatedString(t.username),t.password){let r=Ye(e.authPluginName,t.password,e.seed);n&f.CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA||n&f.CLIENT_SECURE_CONNECTION?(i.write(r.length),i.writeBuffer(r)):(i.writeBuffer(r),i.write(0))}else i.write(0);return n&f.CLIENT_CONNECT_WITH_DB&&t.db&&i.writeNullTerminatedString(t.db),n&f.CLIENT_PLUGIN_AUTH&&i.writeNullTerminatedString(e.authPluginName),i.wroteData}return Uint8Array.from([])}function Yt(e,t=[]){let n=ee(P(e,t)),i=new b(new Uint8Array(n.length+1));return i.write(3),i.writeBuffer(n),i.buffer}var a;(function(e){e[e.OK_Packet=0]="OK_Packet",e[e.EOF_Packet=254]="EOF_Packet",e[e.ERR_Packet=255]="ERR_Packet",e[e.Result=256]="Result"})(a||(a={}));var C=class{body;header;constructor(t,n){this.body=t,this.header={size:t.length,no:n}}async send(t){let n=this.body,i=new b(new Uint8Array(4+n.length));i.writeUints(3,this.header.size),i.write(this.header.no),i.writeBuffer(n),w.debug(`send: ${i.length}B 
${Ve(i.buffer)}
`);try{let r=0;do r+=await t.write(i.buffer.subarray(r));while(r<i.length)}catch(r){throw new se(r.message)}}},Ue=class{header;body;type;async parse(t){let n=new Y(new Uint8Array(4)),i=0,r=await this.read(t,n.buffer);if(r===null)return null;i=r;let o=n.readUints(3);if(this.header={size:o,no:n.readUint8()},this.body=new Y(new Uint8Array(o)),r=await this.read(t,this.body.buffer),r===null)return null;i+=r;let{OK_Packet:s,ERR_Packet:_,EOF_Packet:c,Result:l}=a;switch(this.body.buffer[0]){case s:this.type=s;break;case 255:this.type=_;break;case 254:this.type=c;break;default:this.type=l;break}return Vt(()=>{let I=new Uint8Array(i);I.set(n.buffer),I.set(this.body.buffer,4),w.debug(`receive: ${i}B, size = ${this.header.size}, no = ${this.header.no} 
${Ve(I)}
`)}),this}async read(t,n){let i=n.length,r=0;for(;r<i;){let o=await t.read(n.subarray(r));if(o===null)return null;r+=o}return r}};function Ke(e,t){let i={code:e.readUint16(),message:""};return t.capabilities&f.CLIENT_PROTOCOL_41&&(i.sqlStateMarker=e.readUint8(),i.sqlState=e.readUints(5)),i.message=e.readNullTerminatedString(),i}function Zt(e){let t=e.readUint8(),n=e.readNullTerminatedString(),i=e.readUint32(),r=new b(new Uint8Array(20));r.writeBuffer(e.readBuffer(8)),e.skip(1);let o=e.readUint16(),s=0,_=0,c=0,l="";return e.finished||(s=e.readUint8(),_=e.readUint16(),o|=e.readUint16()<<16,o&f.CLIENT_PLUGIN_AUTH?c=e.readUint8():e.skip(1),e.skip(10),o&f.CLIENT_SECURE_CONNECTION&&r.writeBuffer(e.readBuffer(Math.max(13,c-8))),o&f.CLIENT_PLUGIN_AUTH&&(l=e.readNullTerminatedString())),{protocolVersion:t,serverVersion:n,threadId:i,seed:r.buffer,serverCapabilities:o,characterSet:s,statusFlags:_,authPluginName:l}}var m;(function(e){e[e.AuthPassed=0]="AuthPassed",e[e.MethodMismatch=1]="MethodMismatch",e[e.AuthMoreRequired=2]="AuthMoreRequired"})(m||(m={}));function Qt(e){switch(e.type){case a.EOF_Packet:return m.MethodMismatch;case a.Result:return m.AuthMoreRequired;case a.OK_Packet:return m.AuthPassed;default:return m.AuthPassed}}function Xt(e){let t=e.readLenCodeString(),n=e.readLenCodeString(),i=e.readLenCodeString(),r=e.readLenCodeString(),o=e.readLenCodeString(),s=e.readLenCodeString();e.skip(1);let _=e.readUint16(),c=e.readUint32(),l=e.readUint8(),I=e.readUint16(),E=e.readUint8();e.skip(1);let A=e.readLenCodeString();return{catalog:t,schema:n,table:i,originName:s,fieldFlag:I,originTable:r,fieldLen:c,name:o,fieldType:l,encoding:_,decimals:E,defaultVal:A}}function ke(e,t){let n={};for(let i of t){let r=i.name,o=e.readLenCodeString();n[r]=o===null?null:en(i,o)}return n}function en(e,t){let{fieldType:n,fieldLen:i}=e;switch(n){case 0:case 5:case 4:case 18:return parseFloat(t);case 246:return t;case 1:case 2:case 3:case 9:return parseInt(t);case 8:return Number(t)<Number.MIN_SAFE_INTEGER||Number(t)>Number.MAX_SAFE_INTEGER?BigInt(t):parseInt(t);case 15:case 253:case 254:case 11:case 19:return t;case 10:case 7:case 12:case 14:case 17:return new Date(t);default:return t}}async function tn(e,t){let n=`-----BEGIN PUBLIC KEY-----
`,i=`
-----END PUBLIC KEY-----`;e=e.trim(),e=e.substring(n.length,e.length-i.length);let r=await crypto.subtle.importKey("spki",st(e),{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]);return await crypto.subtle.encrypt({name:"RSA-OAEP"},r,t)}var Ze,Se;async function nn(e,t){return Ze=e,Se=t,{done:!1,next:rn}}async function rn(e){let t;(function(c){c[c.FullAuth=4]="FullAuth",c[c.FastPath=3]="FastPath"})(t||(t={}));let n=2,i=e.body.skip(1).readUint8(),r,o=!0,s,_=!1;return i===4&&(r=new Uint8Array([n]),o=!1,s=on),i===3&&(o=!1,_=!0,s=Qe),{done:o,next:s,quickRead:_,data:r}}async function on(e){let t=sn(e),n=Se.length,i=new Uint8Array(n+1);for(let o=0;o<n;o++)i[o]=Se.charCodeAt(o);i[n]=0;let r=await _n(i,Ze,t);return{done:!1,next:Qe,data:new Uint8Array(r)}}function sn(e){return e.body.skip(1).readNullTerminatedString()}async function _n(e,t,n){let i=ye(e,t);return await tn(n,i)}function Qe(){return{done:!0}}var cn={start:nn},In={caching_sha2_password:cn};function We(e){let t=e.readUint8(),n=e.readNullTerminatedString(),i=e.readRestOfPacketString();return{status:t,authPluginName:n,authPluginData:i}}var U;(function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"})(U||(U={}));var we=class{config;state;capabilities;serverVersion;conn;_timedOut;get remoteAddr(){return this.config.socketPath?`unix:${this.config.socketPath}`:`${this.config.hostname}:${this.config.port}`}constructor(t){this.config=t,this.state=U.CONNECTING,this.capabilities=0,this.serverVersion="",this.conn=void 0,this._timedOut=!1,this._timeoutCallback=()=>{w.info("connection read timed out"),this._timedOut=!0,this.close()}}async _connect(){let{hostname:t,port:n=3306,socketPath:i,username:r="",password:o}=this.config;w.info(`connecting ${this.remoteAddr}`),this.conn=i?await Deno.connect({transport:"unix",path:i}):await Deno.connect({transport:"tcp",hostname:t,port:n});try{let s=await this.nextPacket(),_=Zt(s.body),c=qt(_,{username:r,password:o,db:this.config.db});await new C(c,1).send(this.conn),this.state=U.CONNECTING,this.serverVersion=_.serverVersion,this.capabilities=_.serverCapabilities,s=await this.nextPacket();let l=Qt(s),I;switch(l){case m.AuthMoreRequired:I=In[_.authPluginName];break;case m.MethodMismatch:let R=We(s.body);(R.authPluginData===void 0||R.authPluginData.length===0)&&(R.authPluginData=_.seed);let D;if(o?D=Ye(R.authPluginName,o,R.authPluginData):D=Uint8Array.from([]),await new C(D,s.header.no+1).send(this.conn),s=await this.nextPacket(),We(s.body).authPluginName!=="")throw new Error("Do not allow to change the auth plugin more than once!")}let E;if(I)for(E=await I.start(_.seed,o);!E.done;){if(E.data){let g=s.header.no+1;await new C(E.data,g).send(this.conn),s=await this.nextPacket()}E.quickRead&&await this.nextPacket(),E.next&&(E=await E.next(s))}if(s.body.readUint8()===255){let g=Ke(s.body,this);throw w.error(`connect error(${g.code}): ${g.message}`),this.close(),new Error(g.message)}else w.info(`connected to ${this.remoteAddr}`),this.state=U.CONNECTED;this.config.charset&&await this.execute(`SET NAMES ${this.config.charset}`)}catch(s){throw this.close(),s}}async connect(){await this._connect()}async nextPacket(){if(!this.conn)throw new y("Not connected");let t=this.config.timeout?setTimeout(this._timeoutCallback,this.config.timeout):null,n;try{n=await new Ue().parse(this.conn)}catch(i){throw this._timedOut?new ce("Connection read timed out"):(t&&clearTimeout(t),this.close(),i)}if(t&&clearTimeout(t),!n)throw this.close(),new _e("Connection closed unexpectedly");if(n.type===a.ERR_Packet){n.body.skip(1);let i=Ke(n.body,this);throw new Error(i.message)}return n}_timeoutCallback;close(){this.state!=U.CLOSED&&(w.info("close connection"),this.conn?.close(),this.state=U.CLOSED)}async query(t,n){let i=await this.execute(t,n);return i&&i.rows?i.rows:i}async execute(t,n,i=!1){if(this.state!=U.CONNECTED)throw this.state==U.CLOSED?new y("Connection is closed"):new y("Must be connected first");let r=Yt(t,n);try{await new C(r,0).send(this.conn);let o=await this.nextPacket();if(o.type===a.OK_Packet)return o.body.skip(1),{affectedRows:o.body.readEncodedLen(),lastInsertId:o.body.readEncodedLen()};if(o.type!==a.Result)throw new V;let s=o.body.readEncodedLen(),_=[];for(;s--;){let l=await this.nextPacket();if(l){let I=Xt(l.body);_.push(I)}}let c=[];if(!(this.capabilities&f.CLIENT_DEPRECATE_EOF)&&(o=await this.nextPacket(),o.type!==a.EOF_Packet))throw new V;if(!i){for(;o=await this.nextPacket(),!(o.type===a.EOF_Packet||o.type===a.OK_Packet);){let l=ke(o.body,_);c.push(l)}return{rows:c,fields:_}}return{fields:_,iterator:this.buildIterator(_)}}catch(o){throw this.close(),o}}buildIterator(t){let n=async()=>{let i=await this.nextPacket();return i.type===a.EOF_Packet?{done:!0}:{done:!1,value:ke(i.body,t)}};return{[Symbol.asyncIterator]:()=>({next:n})}}},ge=class{_maxSize;_array;creator;_queue;_size;constructor(t,n=[],i){this._maxSize=t,this._array=n,this.creator=i,this._queue=[],this._size=0,this._size=n.length}get size(){return this._size}get maxSize(){return this._maxSize}get available(){return this._array.length}async pop(){if(this._array.length)return this._array.pop();if(this._size<this._maxSize){this._size++;let n;try{n=await this.creator()}catch(i){throw this._size--,i}return n}let t=Ie();return this._queue.push(t),await t}push(t){return this._queue.length?(this._queue.shift().resolve(t),!1):(this._array.push(t),!0)}tryPopAvailable(){return this._array.pop()}remove(t){let n=this._array.indexOf(t);return n<0?!1:(this._array.splice(n,1),this._size--,!0)}reduceSize(){this._size--}},Le=class extends we{_pool=void 0;_idleTimer=void 0;_idle=!1;enterIdle(){if(this._idle=!0,this.config.idleTimeout){this._idleTimer=setTimeout(()=>{w.info("connection idle timeout"),this._pool.remove(this);try{this.close()}catch(t){w.warning("error closing idle connection",t)}},this.config.idleTimeout);try{Deno.unrefTimer(this._idleTimer)}catch{}}}exitIdle(){this._idle=!1,this._idleTimer!==void 0&&clearTimeout(this._idleTimer)}removeFromPool(){this._pool.reduceSize(),this._pool=void 0}returnToPool(){this._pool?.push(this)}},he=class{_deferred;_connections=[];_closed=!1;constructor(t,n){this._deferred=new ge(t,this._connections,async()=>{let i=await n();return i._pool=this,i})}get info(){return{size:this._deferred.size,maxSize:this._deferred.maxSize,available:this._deferred.available}}push(t){this._closed&&(t.close(),this.reduceSize()),this._deferred.push(t)&&t.enterIdle()}async pop(){if(this._closed)throw new Error("Connection pool is closed");let t=this._deferred.tryPopAvailable();return t?t.exitIdle():t=await this._deferred.pop(),t}remove(t){return this._deferred.remove(t)}close(){this._closed=!0;let t;for(;t=this._deferred.tryPopAvailable();)t.exitIdle(),t.close(),this.reduceSize()}reduceSize(){this._deferred.reduceSize()}},Z=class{config={};_pool;async createConnection(){let t=new Le(this.config);return await t.connect(),t}get pool(){return this._pool?.info}async connect(t){return this.config={hostname:"127.0.0.1",username:"root",port:3306,poolSize:1,timeout:30*1e3,idleTimeout:4*3600*1e3,...t},Object.freeze(this.config),this._pool=new he(this.config.poolSize||10,this.createConnection.bind(this)),this}async query(t,n){return await this.useConnection(async i=>await i.query(t,n))}async execute(t,n){return await this.useConnection(async i=>await i.execute(t,n))}async useConnection(t){if(!this._pool)throw new Error("Unconnected");let n=await this._pool.pop();try{return await t(n)}finally{n.state==U.CLOSED?n.removeFromPool():n.returnToPool()}}async transaction(t){return await this.useConnection(async n=>{try{await n.execute("BEGIN");let i=await t(n);return await n.execute("COMMIT"),i}catch(i){throw n.state==U.CONNECTED&&(w.info(`ROLLBACK: ${i.message}`),await n.execute("ROLLBACK")),i}})}async close(){this._pool&&(this._pool.close(),this._pool=void 0)}};var un=new Z,ln=async()=>{let e={hostname:"https://mysql.9m.wtf",db:"demo",username:"demo_user",password:"demo_user_pass"};return{database:"mysql",data:await(await un.connect(e)).query("SELECT * FROM users")}},Pn={async fetch(e,t,n){let i=await ln();return new Response(JSON.stringify(i),{headers:{"content-type":"application/json;charset=UTF-8"}})}};export{Pn as default};
//# sourceMappingURL=index.mjs.map
